(function($){"use strict";const dp_dfg_vb_cpt_modal='<div id="dp-dfg-vb-wrapper"><div id="dp-dfg-vb-modal"><div class="et-fb-loader-wrapper dp-dfg-vb-loader"><div class="et-fb-loader"></div></div></div></div>';$(document).on("focus","#et-fb-multiple_cpt",function(){if(isDfgVbModule($(this))){const cpt_input=$(this);let input_values=cpt_input.val();if(input_values!==""){if(input_values.includes(",")){input_values=input_values.split(",")}else{input_values=[input_values]}}if($(document).find("#dp-dfg-vb-wrapper").length===0){$("body").append(dp_dfg_vb_cpt_modal);$.ajax({type:"POST",url:dpdfg_admin.ajaxurl,data:{action:"dpdfg_get_cpt_action",_ajax_nonce:dpdfg_admin.nonce_cpt}}).done(function(data){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(data).find("option").each(function(){const cpt_val=$(this).val();if(input_values.includes(cpt_val)){$(this).prop("selected",true)}});$(".dp-dfg-vb-submit").click(function(){const cpt=$(".dp-dfg-vb-select").val();cpt_input.trigger("focus").val(cpt.join(",")).trigger("blur");$(".dp-dfg-vb-finish").click()});$(".dp-dfg-vb-finish").click(function(){$("#dp-dfg-vb-wrapper").remove()});$(".dp-dfg-vb-clean").click(function(){cpt_input.trigger("focus").val("").trigger("blur")})}).fail(function(jqXHR,textStatus,errorThrown){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(errorThrown).on("click",function(){$("#dp-dfg-vb-wrapper").remove()})})}}});$(document).on("focus","#et-fb-multiple_taxonomies, #et-fb-exclude_taxonomies, #et-fb-filter_taxonomies, #et-fb-show_terms_taxonomy, #et-fb-related_taxonomies",function(){if(isDfgVbModule($(this))){const taxonomies_input=$(this);let input_values=taxonomies_input.val();let cpt=$("#et-fb-multiple_cpt").val();if($(this).prop("id")==="et-fb-filter_taxonomies"||$(this).prop("id")==="et-fb-show_terms_taxonomy"||$(this).prop("id")==="et-fb-related_taxonomies"){cpt="all"}if(input_values!==""){if(input_values.includes(",")){input_values=input_values.split(",")}else{input_values=[input_values]}}if($(document).find("#dp-dfg-vb-wrapper").length===0){$("body").append(dp_dfg_vb_cpt_modal);$.ajax({type:"POST",url:dpdfg_admin.ajaxurl,data:{action:"dpdfg_get_taxonomies_action",cpt:cpt===undefined||cpt===""?"post":cpt,_ajax_nonce:dpdfg_admin.nonce_tax}}).done(function(data){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(data).find("option").each(function(){const cpt_val=$(this).val();if(input_values.includes(cpt_val)){$(this).prop("selected",true)}});$(".dp-dfg-vb-submit").click(function(){const taxonomies=$(".dp-dfg-vb-select").val();taxonomies_input.trigger("focus").val(taxonomies.join(",")).trigger("blur");$(".dp-dfg-vb-finish").click()});$(".dp-dfg-vb-finish").click(function(){$("#dp-dfg-vb-wrapper").remove()});$(".dp-dfg-vb-clean").click(function(){taxonomies_input.trigger("focus").val("").trigger("blur")})}).fail(function(jqXHR,textStatus,errorThrown){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(errorThrown).on("click",function(){$("#dp-dfg-vb-wrapper").remove()})})}}});$(document).on("focus","#et-fb-include_terms, #et-fb-exclude_terms, #et-fb-default_filter, #et-fb-filter_terms",function(){if(isDfgVbModule($(this))){const terms_input=$(this);const input_class=terms_input.attr("id");let input_values=terms_input.val();let tax="";let cpt="";if(input_class==="et-fb-default_filter"||input_class==="et-fb-filter_terms"){tax=$("#et-fb-filter_taxonomies").val();cpt="all";tax=tax===""?"category":tax}else if(input_class==="et-fb-include_terms"){tax=$("#et-fb-multiple_taxonomies").val();cpt=$("#et-fb-multiple_cpt").val()}else if(input_class==="et-fb-exclude_terms"){tax=$("#et-fb-exclude_taxonomies").val();cpt=$("#et-fb-multiple_cpt").val()}if(input_values!==""){if(input_values.includes(",")){input_values=input_values.split(",")}else{input_values=[input_values]}}if($(document).find("#dp-dfg-vb-wrapper").length===0){$("body").append(dp_dfg_vb_cpt_modal);$.ajax({type:"POST",url:dpdfg_admin.ajaxurl,data:{action:"dpdfg_get_taxonomies_terms_action",tax:tax===undefined||tax===""?"all":tax,cpt:cpt===undefined||cpt===""?"post":cpt,_ajax_nonce:dpdfg_admin.nonce_terms}}).done(function(data){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(data).find("option").each(function(){const cpt_val=$(this).val();if(input_values.includes(cpt_val)){$(this).prop("selected",true)}});if(input_class==="et-fb-default_filter"){$("#dp-dfg-vb-modal").find(".dp-dfg-vb-select").removeAttr("multiple");let description=$("#dp-dfg-vb-modal").find(".dp-dfg-modal-description");description.text(description.attr("data-singular"))}$(".dp-dfg-vb-submit").click(function(){let terms=$(".dp-dfg-vb-select").val();if(!Array.isArray(terms)){terms=[terms]}terms_input.trigger("focus").val(terms.join(",")).trigger("blur");$(".dp-dfg-vb-finish").click()});$(".dp-dfg-vb-finish").click(function(){$("#dp-dfg-vb-wrapper").remove()});$(".dp-dfg-vb-clean").click(function(){terms_input.trigger("focus").val("").trigger("blur")})}).fail(function(jqXHR,textStatus,errorThrown){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(errorThrown).on("click",function(){$("#dp-dfg-vb-wrapper").remove()})})}}});$(document).on("focus","#dpdfg_input_custom_fields",function(){if(isDfgVbModule($(this))){if($(document).find("#dp-dfg-vb-wrapper").length===0){$("body").append(dp_dfg_vb_cpt_modal);const cf_input=$(this);$.ajax({type:"POST",url:dpdfg_admin.ajaxurl,data:{action:"dpdfg_get_custom_fields_action",_ajax_nonce:dpdfg_admin.nonce_cf}}).done(function(data){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(data);let cf_container=$(".dp-dfg-cf-selection");try{if(cf_input.val()!==""){const cf_array=JSON.parse(cf_input.val());if(Array.isArray(cf_array)){cf_container.html("");let cf_number=cf_array.length;for(let i=0;i<cf_number;i++){const cf=cf_array[i];cf_container.append('<div id="dp-dfg-cf-'+cf.name+'" class="dp-dfg-cf" data-cf="'+cf.name+'" data-pos="'+i+'"><span class="dp-dfg-cf-remove dashicons dashicons-trash"></span><input class="dp-dfg-cf-lb" type="text" name="'+cf.name+'_label" placeholder="'+cf.name+'" value="'+cf.label+'"/><span class="dp-dfg-cf-move dashicons dashicons-move"></span></div>')}}}}catch(e){console.log(e)}$(".dp-dfg-cf-selection").sortable().disableSelection();$("#dp-dfg-cf-select").autocomplete({source:dpdfg_admin.customFields,appendTo:"#dp-dfg-cf-form"});$(".dp-dfg-cf-plus").click(function(){const cf_container=$(".dp-dfg-cf-selection");const selected_cf=$("#dp-dfg-cf-select").val();if(selected_cf!==""&&$(cf_container).find("#dp-dfg-cf-"+selected_cf).length===0){cf_container.append('<div id="dp-dfg-cf-'+selected_cf+'" class="dp-dfg-cf" data-cf="'+selected_cf+'"><span class="dp-dfg-cf-remove dashicons dashicons-trash"></span><input class="dp-dfg-cf-lb" type="text" name="'+selected_cf+'_label" placeholder="'+selected_cf+'" value=""/><span class="dp-dfg-cf-move dashicons dashicons-move"></span></div>');$("#dp-dfg-cf-select").val("");$(".dp-dfg-cf-remove").click(function(){$(this).parents(".dp-dfg-cf").remove()})}});$(".dp-dfg-cf-remove").click(function(){$(this).parents(".dp-dfg-cf").remove()});$(".dp-dfg-vb-submit").click(function(){const custom_fields=[];$(".dp-dfg-cf").each(function(){const cf={};cf.name=$(this).attr("data-cf");cf.label=$(this).find(".dp-dfg-cf-lb").val();custom_fields.push(cf)});if(custom_fields.length!==0){cf_input.trigger("focus").val(JSON.stringify(custom_fields)).trigger("blur")}$(".dp-dfg-vb-finish").click()});$(".dp-dfg-vb-finish").click(function(){$("#dp-dfg-vb-wrapper").remove()});$(".dp-dfg-vb-clean").click(function(){cf_input.trigger("focus").val("").trigger("blur");$(".dp-dfg-vb-finish").click()})}).fail(function(jqXHR,textStatus,errorThrown){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(errorThrown).on("click",function(){$("#dp-dfg-vb-wrapper").remove()})})}}});$(document).on("focus","#dpdfg_input_multilevel_tax_data, #dpdfg_input_multilevel_hierarchy_tax",function(){const hierarchy_level=$("#et-fb-multilevel_hierarchy").val();if(isDfgVbModule($(this))){if($(document).find("#dp-dfg-vb-wrapper").length===0){$("body").append(dp_dfg_vb_cpt_modal);const cf_input=$(this);$.ajax({type:"POST",url:dpdfg_admin.ajaxurl,data:{action:"dpdfg_get_multilevel_tax_action",_ajax_nonce:dpdfg_admin.nonce_ml_tax}}).done(function(data){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(data);let cf_container=$(".dp-dfg-cf-selection");if(hierarchy_level==="on"){let description=$("#dp-dfg-vb-modal").find(".dp-dfg-modal-description");description.text(description.attr("data-text-alt"))}try{if(cf_input.val()!==""){const cf_array=JSON.parse(cf_input.val());if(Array.isArray(cf_array)){cf_container.html("");let cf_number=cf_array.length;for(let i=0;i<cf_number;i++){const cf=cf_array[i];if(cf.all===undefined){cf.all=""}cf_container.append('<div id="dp-dfg-cf-'+cf.name+'" class="dp-dfg-cf" data-cf="'+cf.name+'" data-pos="'+i+'">'+'<span class="dp-dfg-cf-remove dashicons dashicons-trash"></span>'+"<div>"+'<input class="dp-dfg-cf-lb" type="text" name="'+cf.name+'_label" placeholder="'+dpdfg_admin.i18n.ml_tax_level_label+" "+cf.name+'" value="'+cf.label+'"/>'+'<input class="dp-dfg-cf-all" type="text" name="'+cf.name+'_all" placeholder="'+dpdfg_admin.i18n.ml_tax_level_all+" "+cf.name+'" value="'+cf.all+'"/>'+"</div>"+'<span class="dp-dfg-cf-move dashicons dashicons-move"></span>'+"</div>")}}}}catch(e){console.log(e)}$(".dp-dfg-cf-selection").sortable().disableSelection();$(".dp-dfg-cf-plus").click(function(){const cf_container=$(".dp-dfg-cf-selection");const selected_cf=$("#dp-dfg-cf-select").val();if(selected_cf!==""&&$(cf_container).find("#dp-dfg-cf-"+selected_cf).length===0){if(hierarchy_level==="on"){cf_container.html("")}cf_container.append('<div id="dp-dfg-cf-'+selected_cf+'" class="dp-dfg-cf" data-cf="'+selected_cf+'">'+'<span class="dp-dfg-cf-remove dashicons dashicons-trash"></span>'+"<div>"+'<input class="dp-dfg-cf-lb" type="text" name="'+selected_cf+'_label" placeholder="'+dpdfg_admin.i18n.ml_tax_level_label+" "+selected_cf+'" value=""/>'+'<input class="dp-dfg-cf-all" type="text" name="'+selected_cf+'_all" placeholder="'+dpdfg_admin.i18n.ml_tax_level_all+" "+selected_cf+'" value=""/>'+"</div>"+'<span class="dp-dfg-cf-move dashicons dashicons-move"></span>'+"</div>");$(".dp-dfg-cf-remove").click(function(){$(this).parents(".dp-dfg-cf").remove()})}});$(".dp-dfg-cf-remove").click(function(){$(this).parents(".dp-dfg-cf").remove()});$(".dp-dfg-vb-submit").click(function(){const custom_fields=[];$(".dp-dfg-cf").each(function(){const cf={};cf.name=$(this).attr("data-cf");cf.label=$(this).find(".dp-dfg-cf-lb").val();cf.all=$(this).find(".dp-dfg-cf-all").val();custom_fields.push(cf)});if(custom_fields.length!==0){cf_input.trigger("focus").val(JSON.stringify(custom_fields)).trigger("blur")}$(".dp-dfg-vb-finish").click()});$(".dp-dfg-vb-finish").click(function(){$("#dp-dfg-vb-wrapper").remove()});$(".dp-dfg-vb-clean").click(function(){cf_input.trigger("focus").val("").trigger("blur");$(".dp-dfg-vb-finish").click()})}).fail(function(jqXHR,textStatus,errorThrown){$(".dp-dfg-vb-loader").remove();$("#dp-dfg-vb-modal").append(errorThrown).on("click",function(){$("#dp-dfg-vb-wrapper").remove()})})}}});function isDfgVbModule(trigger){const modal_title=trigger.parents(".et-fb-modal__content").siblings(".et-fb-modal__header").find(".et-fb-modal__title").text();return!!modal_title.includes("Divi FilterGrid")}})(jQuery);